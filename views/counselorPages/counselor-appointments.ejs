<!DOCTYPE html>

<html lang="en" class="light-style layout-menu-fixed" data-assets-path="" data-base-url="" data-framework="django" data-template="vertical-menu-free">

  <head>
	<%- include('../includes/head.ejs') %>



  </head>

  <body>
	<!-- Layout wrapper: Start -->
	<div class="layout-wrapper layout-content-navbar">
	  <div class="layout-container">
	
		<%- include('../includes/sidebar-counselor.ejs') %>
	
		<!-- Layout page: Start -->
		<div class="layout-page">
	
	
		  <!-- Navbar: Start -->
		  <%- include('../includes/header-counselor.ejs') %>
		  <!-- Navbar: End -->
	
	
		  <!-- Content wrapper: Start -->
		  <div class="content-wrapper">
			<!-- Content: Start -->
			

      <div class="card">
        <h5 class="card-header">My Appointments</h5>
        <div class="card-body">
          <% if (appointments.length > 0) { %>
      
            <!-- Example: Grouping by status (loop through each status category) -->
            <% const statusGroups = ['Pending', 'Approved', 'Completed', 'Cancelled']; %>
            <% statusGroups.forEach(status => { 
                 const filtered = appointments.filter(app => app.status.toLowerCase() === status.toLowerCase()); 
                 if (filtered.length > 0) { %>
      
              <h6 class="mt-4"><%= status %> Appointments</h6>
              <div class="table-responsive text-nowrap mb-4">
                <table id="table" class="table table-bordered">
                  <thead>
                    <tr>
                      <th>Title</th>
                      <th>Student</th>
                      <th>Date</th>
                      <th>Type</th>
                      <th>Appointment #</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% filtered.forEach(appointment => { %>
                      <tr>
                        <td><%= appointment.title %></td>
                        <td><%= appointment.student_first_name %> <%= appointment.student_last_name %></td>
                        <td><%= new Date(appointment.appointment_date).toLocaleString() %></td>
                        <td><%= appointment.is_online_appointment ? 'Online' : 'Face-to-Face' %></td>
                        <td><%= appointment.appointment_number %></td>
                        <td>
                          <span class="badge 
                            <%= appointment.status === 'approved' ? 'bg-success' :
                                appointment.status === 'pending' ? 'bg-warning text-dark' :
                                appointment.status === 'cancelled' || appointment.status === 'rejected' ? 'bg-danger' :
                                'bg-secondary' %>">
                            <%= appointment.status.toUpperCase() %>
                          </span>
                        </td>
                        <td>
                          <% if (appointment.status !== 'cancelled' && appointment.status !== 'completed') { %>
                            <div class="dropdown">
                              <button class="btn p-0 dropdown-toggle" data-bs-toggle="dropdown">
                                <i class="bx bx-dots-vertical-rounded"></i>
                              </button>
                              <div class="dropdown-menu">
                                <% if (appointment.status === 'pending') { %>
                                  <a class="dropdown-item text-success" href="/counselor/appointments/approve/<%= appointment.id %>">
                                    <i class="bi bi-check2-circle me-2"></i>Approve
                                  </a>
                                <% } %>
                                <% if (appointment.status === 'pending' || appointment.status === 'approved') { %>
                                  <a class="dropdown-item text-danger" href="/appointments/cancel/<%= appointment.id %>">
                                    <i class="bi bi-x-circle me-2"></i>Cancel
                                  </a>
                                <% } %>
                                <% if (appointment.status === 'approved') { %>
                                  <a class="dropdown-item text-success" href="/counselor/appointments/completed/<%= appointment.id %>">
                                    <i class="bi bi-check-circle me-2"></i>Mark as Completed
                                  </a>
                                <% } %>
                                <% if (appointment.is_online_appointment) { %>
                                  <a class="dropdown-item" href="/counselor/appointments/<%= appointment.id %>/chat">
                                    <i class="bi bi-chat-dots me-2"></i>Go to Chat
                                  </a>
                                <% } %>
                              </div>
                            </div>
                          <% } else { %>
                            <small class="text-muted">No actions</small>
                          <% } %>
                        </td>
                      </tr>
                    <% }) %>
                  </tbody>
                </table>
              </div>
            <% }}); %>
      
          <% } else { %>
            <div class="text-center mt-5">
              <i class="bi bi-emoji-frown display-4 text-secondary"></i>
              <p class="mt-3 fs-5 text-muted">No appointments found.</p>
            </div>
          <% } %>
        </div>
      </div>
      

          
  
  
                  
			
	
			  <!-- / Content: End -->
	
			  <!-- Footer: Start -->
			  <!-- Footer: End -->

	
			  <div class="content-backdrop fade"></div>
        
			<!--/ Content wrapper: End -->
      
		  </div>
			  <%- include('../includes/footer.ejs') %>
      
		  <!-- / Layout page: End -->
		</div>
	
		<!-- Overlay -->
		<div class="layout-overlay layout-menu-toggle"></div>
		<!-- Drag Target Area To SlideIn Menu On Small Screens -->
		<div class="drag-target"></div>
	  </div>
	  <!-- Layout wrapper: End -->
	

	  <%- include('../includes/scripts.ejs') %>



  </body>

</html>